<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Flurimo ‚Äî –ú–∞–≥–∞–∑–∏–Ω</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body { font-family: Arial, sans-serif; margin: 0; background: #faf9f7; }
header { padding: 16px; text-align: center; font-size: 22px; font-weight: 600; }
.card { background: #fff; margin: 12px; border-radius: 14px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,.05); }
.card img { width: 100%; height: 240px; object-fit: cover; }
.card-content { padding: 14px; }
.price { font-weight: bold; margin: 8px 0; }
.status { font-size: 13px; opacity: .6; margin-bottom: 10px; }
button { width: 100%; padding: 12px; background: #000; color: #fff; border: none; border-radius: 8px; font-size: 16px; }
button:disabled { background: #ccc; }
</style>
</head>

<body>
<header>üå∏ Flurimo</header>
<div id="catalog"></div>

<script>
const API_URL = "https://api.sheetbest.com/sheets/193f6c1f-a255-4b91-90c4-22adf825b1a0";

fetch(API_URL)
  .then(res => res.json())
  .then(data => {
    console.log("–î–∞–Ω–Ω—ã–µ –∏–∑ Sheet.best:", data);
    const catalog = document.getElementById('catalog');

    // –ï—Å–ª–∏ data –Ω–µ –º–∞—Å—Å–∏–≤, –ø—Ä–æ–±—É–µ–º —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ JSON
    if (!Array.isArray(data)) {
        try { data = JSON.parse(data); } catch(e) { console.error(e); }
    }

    if (!Array.isArray(data) || data.length === 0) {
      catalog.innerHTML = "<p>–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.</p>";
      return;
    }

    data.forEach(item => {
      const name = (item["Name"] || "–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è").trim();
      const image = (item["Image"] || "").trim(); // —É–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã/–ø–µ—Ä–µ–Ω–æ—Å—ã
      const description = (item["Description"] || "").trim();
      const quantity = Number((item["Quantity"] || "0").trim());
      const price = (item["Price"] || "0").trim();

      let statusText = "–í –Ω–∞–ª–∏—á–∏–∏";
      let disabled = false;

      if (quantity <= 0) {
        statusText = "–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏";
        disabled = true;
      }

      const card = document.createElement('div');
      card.className = 'card';
      card.innerHTML = `
        <img src="${image}" alt="${name}" onerror="this.style.display='none'">
        <div class="card-content">
          <h3>${name}</h3>
          <p>${description}</p>
          <div class="status">${statusText}</div>
          <div class="price">${price} ‚ÇΩ</div>
          <button ${disabled ? 'disabled' : ''} onclick="order('${name}')">–û—Ñ–æ—Ä–º–∏—Ç—å</button>
        </div>
      `;
      catalog.appendChild(card);
    });
  })
  .catch(err => {
    console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", err);
    document.getElementById('catalog').innerHTML = "<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤.</p>";
  });

function order(name) {
  Telegram.WebApp.sendData("–ó–∞–∫–∞–∑ Flurimo: " + name);
}
</script>
</body>
</html>

